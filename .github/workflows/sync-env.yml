name: Sync Railway Env Vars

on:
  # Manual trigger â€” pick an environment from the dropdown
  workflow_dispatch:
    inputs:
      environment:
        description: "Railway environment to sync"
        required: true
        type: choice
        options:
          - staging
          - production

  # Callable from other workflows (e.g., deploy.yml)
  workflow_call:
    inputs:
      environment:
        required: true
        type: string

jobs:
  sync:
    name: Push env vars to Railway (${{ inputs.environment }})
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v5

      - name: Set up Python 3.12
        run: uv python install 3.12

      - name: Sync env vars to Railway
        run: uv run python scripts/push_env_to_railway.py --env ${{ inputs.environment }} --from-env
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
          # Source Access
          UNIPILE_API_KEY: ${{ secrets.UNIPILE_API_KEY }}
          UNIPILE_DSN: ${{ secrets.UNIPILE_DSN }}
          X_BEARER_TOKEN: ${{ secrets.X_BEARER_TOKEN }}
          X_CONSUMER_KEY: ${{ secrets.X_CONSUMER_KEY }}
          X_SECRET_KEY: ${{ secrets.X_SECRET_KEY }}
          X_USERNAME: ${{ secrets.X_USERNAME }}
          POSTHOG_API_KEY: ${{ secrets.POSTHOG_API_KEY }}
          POSTHOG_PROJECT_ID: ${{ secrets.POSTHOG_PROJECT_ID }}
          RB2B_API_KEY: ${{ secrets.RB2B_API_KEY }}
          # Data Access
          SUPABASE_DB_URL: ${{ secrets.SUPABASE_DB_URL }}
          # Config Access
          UPSTASH_REDIS_REST_URL: ${{ secrets.UPSTASH_REDIS_REST_URL }}
          UPSTASH_REDIS_REST_TOKEN: ${{ secrets.UPSTASH_REDIS_REST_TOKEN }}
          # LLM Gateway
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          # Temporal (shared)
          TEMPORAL_API_KEY: ${{ secrets.TEMPORAL_API_KEY }}
          TEMPORAL_NAMESPACE: ${{ secrets.TEMPORAL_NAMESPACE }}
          TEMPORAL_REGIONAL_ENDPOINT: ${{ secrets.TEMPORAL_REGIONAL_ENDPOINT }}
